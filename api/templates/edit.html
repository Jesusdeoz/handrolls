{% extends "base.html" %}
{% block title %}Editar pedido #{{ o.id }}{% endblock %}
{% block content %}

<h2>Editar pedido #{{ o.id }}</h2>

<style>
  .sub { color:#6b7280; font-size:12px; }
  .textarea-lg { width:100%; min-height:90px; }
  .card form label { display:block; }
</style>

<form method="post" action="/orders/{{ o.id }}/update" class="card">

  <label>Nombre cliente<br>
    <input name="cliente_nombre" value="{{ o.cliente_nombre }}" required>
  </label><br><br>

  <label>Teléfono<br>
    <input name="telefono" value="{{ o.telefono or '' }}" placeholder="+56912345678">
  </label><br><br>

  <label>Detalle<br>
    <textarea name="detalle" class="textarea-lg" rows="5" style="width:100%" required>{{ o.detalle }}</textarea>
  </label><br><br>

  <fieldset>
    <legend>Soya</legend>
    <label>
      <input type="number" name="soya_normal_qty" min="0" placeholder="0" style="width:70px"
             value="{{ o.soya_normal_qty }}">
      Soya normal
    </label>
    <label style="margin-left:16px">
      <input type="number" name="soya_dulce_qty" min="0" placeholder="0" style="width:70px"
             value="{{ o.soya_dulce_qty }}">
      Soya dulce
    </label>
    <div class="sub">Deja en blanco o 0 si no corresponde.</div>
  </fieldset><br>

  <fieldset>
    <legend>Modalidad</legend>
    <label><input type="radio" name="modalidad" value="retiro"  {% if o.modalidad=='retiro' %}checked{% endif %}> Retiro</label>
    <label><input type="radio" name="modalidad" value="despacho" {% if o.modalidad=='despacho' %}checked{% endif %}> Despacho</label>
  </fieldset><br>

  <div id="direccionBox" style="display: {{ 'block' if o.modalidad=='despacho' else 'none' }}">
    <label>Dirección<br><input name="direccion" value="{{ o.direccion or '' }}"></label><br><br>
    <label>Comuna<br><input name="comuna" value="{{ o.comuna or '' }}"></label><br><br>
  </div>

  <label>Método de pago<br>
    <select name="medio_pago" required>
      <option value="debito_credito" {% if o.medio_pago=='debito_credito' %}selected{% endif %}>Débito/Crédito</option>
      <option value="transferencia"  {% if o.medio_pago=='transferencia' %}selected{% endif %}>Transferencia</option>
      <option value="efectivo"       {% if o.medio_pago=='efectivo' %}selected{% endif %}>Efectivo</option>
    </select>
  </label><br><br>

  <label>Monto total (CLP)<br>
    <input name="monto_total_clp" type="number" min="0" value="{{ o.monto_total_clp or 0 }}">
  </label><br><br>

  <label>Observaciones<br>
    <textarea name="observaciones" class="textarea-lg" rows="3" style="width:100%">{{ o.observaciones or '' }}</textarea>
  </label><br><br>

  <button class="btn" type="submit">Guardar cambios</button>
  <a class="btn" href="/">Cancelar</a>
</form>

<script>
  // mostrar/ocultar dirección según modalidad
  const radios = document.querySelectorAll('input[name="modalidad"]');
  const box = document.getElementById('direccionBox');
  function toggleDir() {
    const v = [...radios].find(r=>r.checked)?.value;
    box.style.display = (v === 'despacho') ? '' : 'none';
  }
  radios.forEach(r=>r.addEventListener('change', toggleDir));
</script>

{% endblock %}
