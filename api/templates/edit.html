{% extends "base.html" %}
{% block title %}Editar pedido #{{ o.id }}{% endblock %}
{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
<script defer src="{{ url_for('static', filename='edit.js') }}"></script>

<h2>Editar pedido #{{ o.id }}</h2>

<form method="post" action="/orders/{{ o.id }}/update" class="card" id="editForm">
  <label>Nombre cliente<br>
    <input name="cliente_nombre" value="{{ o.cliente_nombre }}" required>
  </label><br><br>

  <label>Tel√©fono<br>
    <input name="telefono" type="tel" inputmode="numeric" autocomplete="tel"
           placeholder="+56912345678" pattern="[0-9+ ]*"
           value="{{ o.telefono or '' }}">
  </label><br><br>

  <!-- PROMO -->
  <label>Promoci√≥n (opcional)</label>
  <div class="promo-row">
    <select id="promoSelect">
      <option value="">‚Äî Selecciona promo ‚Äî</option>
    </select>
    <button type="button" class="btn btn-sm" id="clearPromo">Limpiar</button>
  </div>
  <div class="sub">Al elegir una promo, se rellena autom√°ticamente el Detalle y el Monto promo.</div>
  <br>

  <label>Detalle<br>
    <textarea name="detalle" id="detalleField" class="textarea-lg" rows="5" required>{{ o.detalle or '' }}</textarea>
  </label><br><br>

  <!-- SOYA -->
  <fieldset>
    <legend>Soya</legend>
    <div class="soya-wrap">
      <label class="soya-row">
        <input type="number" name="soya_normal_qty" min="0" placeholder="0"
               value="{{ o.soya_normal_qty or 0 }}">
        <span>Soya normal</span>
      </label>
      <label class="soya-row">
        <input type="number" name="soya_dulce_qty" min="0" placeholder="0"
               value="{{ o.soya_dulce_qty or 0 }}">
        <span>Soya dulce</span>
      </label>
    </div>
    <div class="sub">Deja en blanco o 0 si no corresponde.</div>
  </fieldset>

  <!-- PALITOS -->
  <fieldset>
    <legend>Palitos</legend>
    <label>Pares de palitos (opcional)<br>
      <input type="number" name="palitos_pares" min="0" step="1" placeholder="0" class="w-100px"
             value="{{ o.palitos_pares or '' }}">
    </label><br><br>
  </fieldset>

  <!-- MODALIDAD -->
  <fieldset>
    <legend>Modalidad</legend>
    <div class="modalidad-group">
      <label>
        <input type="radio" name="modalidad" value="retiro"
               {% if (o.modalidad or 'retiro') == 'retiro' %}checked{% endif %}>
        <span>Retiro</span>
      </label>
      <label>
        <input type="radio" name="modalidad" value="despacho"
               {% if o.modalidad == 'despacho' %}checked{% endif %}>
        <span>Despacho</span>
      </label>
    </div>
  </fieldset><br>

  <!-- DIRECCI√ìN (solo despacho) -->
  <div id="direccionBox" style="display:none">
    <label>Direcci√≥n<br><input name="direccion" value="{{ o.direccion or '' }}"></label><br><br>
    <label>Comuna<br><input name="comuna" placeholder="ej: Maip√∫" value="{{ o.comuna or '' }}"></label><br><br>
  </div>

  <!-- PAGO / DESPACHO / TOTAL (oculto) / OBS -->
  <label>M√©todo de pago<br>
    <select name="medio_pago" required>      
      <option value="transferencia"  {% if o.medio_pago=='transferencia' %}selected{% endif %}>Transferencia</option>
      <option value="efectivo"       {% if o.medio_pago=='efectivo' %}selected{% endif %}>Efectivo</option>
    </select>
  </label><br><br>

  <!-- üëá Nuevo esquema: mostramos Monto promo + Despacho; ocultamos el Total -->
  <label>Monto promo (CLP)<br>
    <input id="promoAmount" type="number" inputmode="numeric"
           value="">
  </label><br><br>

  <label>Despacho (CLP)<br>
    <input name="despacho_clp" id="despachoField" type="number" min="0" value="{{ o.despacho_clp or 0 }}">
  </label><br><br>

  <!-- Total oculto que se env√≠a al backend -->
  <input type="hidden" name="monto_total_clp" id="montoField" value="{{ o.monto_total_clp or 0 }}">

  <label>Observaciones<br>
    <textarea name="observaciones" class="textarea-lg" rows="3">{{ o.observaciones or '' }}</textarea>
  </label><br><br>

  <button class="btn" type="submit">Guardar cambios</button>
  <a class="btn btn-sm" href="/">Volver</a>
</form>

{% endblock %}
